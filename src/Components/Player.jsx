import React, {Component} from "react";
import "./Player.css";
import Timeline from "../Assets/Images/Timeline.svg";
import WaveSurfer from 'wavesurfer.js';
import Truncate from "../Assets/JS/truncator";

class Player extends Component{
    constructor(props) {
        super(props);
        this.state = {
            full: props.full,
            playing: props.playing,
            track: props.track
        }
        this.handlePlay = this.handlePlay.bind(this);
    }

    componentDidMount() {
        const track = document.querySelector('#track');

        this.waveform = WaveSurfer.create({
            barWidth: 3,
            cursorWidth: 1,
            container: '#timeline',
            backend: 'WebAudio',
            height: 27,
            progressColor: '#336CFB',
            responsive: true,
            waveColor: '#D4D3D3',
            cursorColor: 'transparent',
        });

        this.waveform.load(track);
    }
    
    componentWillReceiveProps() {
        this.setState({...this.state, full: !this.state.full})
    }
  
    handlePlay = () => {
      this.setState({...this.state, playing: !this.state.playing });
      this.waveform.playPause();
    }

    render() {
        return(
            <section className="player" style={{width: this.state.full? "calc(100% - 240px)" : "100%", left: this.state.full? "240px" : "0"}}>
                <div className="player-art-and-name">
                    <div className="art">
                        <img src="./Images/Player-cover.png" alt=""/>
                    </div>
                    <div className="song-title-and-artist">
                        <h3>{Truncate(this.state.track.name, 0, 15)}</h3>
                        <h5>Fit for a King</h5>
                    </div>
                </div>
                <div className="player-timeline-and-time">
                    <div id="timeline">
                    </div>
                    <div className="time">
                        <div className="time-played">2:01</div>
                        <div className="total-time">4:24</div>
                    </div>
                    <audio id="track" src={this.state.track.url} />
                </div>
                <div className="controls">
                    <div className="volume-repeat-shuffle">
                        <button className="repeat">
                            <svg width="16px" height="14px" viewBox="0 0 16 14" version="1.1">
                                <path 
                                    d="M10.7296 1.97355L10.7367 1.97392C13.6468 1.97793 16 4.32989 16 7.23651C16 8.54762 15.4752 9.7821 14.5607 10.696C14.3035 10.953 13.8863 10.9532 13.6289 10.6964C13.3715 10.4396 13.3713 10.0231 13.6285 9.76606C14.2991 9.09593 14.6823 8.19454 14.6823 7.23651C14.6823 5.05396 12.9151 3.28943 10.7292 3.28943L10.724 3.28916L7.04941 3.28916L7.90124 4.13969C8.15852 4.39659 8.15852 4.81313 7.90124 5.07003C7.64395 5.32693 7.22678 5.32693 6.96949 5.07003L4.99296 3.09649C4.97761 3.08116 4.96309 3.06504 4.94932 3.04826C4.94308 3.04071 4.93768 3.03269 4.93184 3.02492C4.9248 3.01554 4.91751 3.00636 4.91096 2.99658C4.90469 2.98724 4.89926 2.97752 4.89355 2.96796C4.88823 2.95914 4.88267 2.95048 4.8778 2.94138C4.87258 2.93164 4.86813 2.92159 4.86343 2.91163C4.85896 2.90213 4.8542 2.89278 4.85015 2.88304C4.84617 2.87339 4.84293 2.86352 4.83941 2.85371C4.83567 2.84326 4.83166 2.83296 4.82841 2.82229C4.82542 2.81249 4.82326 2.80253 4.82075 2.7926C4.81801 2.78171 4.81495 2.77098 4.81276 2.75988C4.81047 2.74841 4.80914 2.73684 4.80747 2.72528C4.80608 2.7156 4.80423 2.70607 4.80327 2.69626C4.80117 2.67492 4.80006 2.65349 4.80003 2.63206L4.8 2.63135L4.80003 2.6307C4.80003 2.60924 4.80117 2.58781 4.80327 2.56644C4.80426 2.55663 4.80608 2.54714 4.80747 2.53745C4.80911 2.52592 4.81047 2.51433 4.81276 2.50286C4.81495 2.49175 4.81801 2.48102 4.82075 2.47014C4.82326 2.46021 4.82545 2.45022 4.82841 2.44041C4.83166 2.42974 4.83564 2.41944 4.83941 2.40902C4.84293 2.39921 4.84617 2.38932 4.85019 2.37963C4.85423 2.36992 4.85899 2.36058 4.86347 2.35108C4.86816 2.34112 4.87261 2.33107 4.87783 2.32129C4.88271 2.31219 4.88826 2.30356 4.89355 2.29474C4.89926 2.28515 4.90469 2.27544 4.91096 2.26609C4.91748 2.25635 4.92474 2.24719 4.93178 2.23782C4.93765 2.23001 4.94308 2.222 4.94932 2.21441C4.96309 2.19767 4.97761 2.18154 4.99296 2.16621L6.96949 0.192674C7.22678 -0.0642248 7.64395 -0.0642248 7.90124 0.192674C8.15852 0.449574 8.15852 0.866114 7.90124 1.12301L7.04941 1.97355L10.7296 1.97355ZM11.0891 11.7339C11.0826 11.7436 11.0754 11.7527 11.0684 11.7621C11.0625 11.7699 11.0571 11.7779 11.0508 11.7856C11.0371 11.8022 11.0227 11.8182 11.0075 11.8334L11.0071 11.8338L9.03057 13.8073C8.77328 14.0642 8.3561 14.0642 8.09881 13.8073C7.84152 13.5504 7.84152 13.1339 8.09881 12.877L8.95064 12.0265L5.27046 12.0265L5.26339 12.0261C2.3532 12.0221 0 9.67012 0 6.76342C0 5.45231 0.524804 4.21784 1.43933 3.304C1.69653 3.04698 2.11367 3.04679 2.37109 3.3036C2.6285 3.5604 2.62868 3.97691 2.37149 4.23393C1.70091 4.90407 1.31771 5.80545 1.31771 6.76348C1.31771 8.94602 3.08493 10.7105 5.2708 10.7105L5.27602 10.7108L8.95064 10.7108L8.09881 9.86029C7.84152 9.60339 7.84152 9.18685 8.09881 8.92995C8.3561 8.67306 8.77328 8.67306 9.03057 8.92995L11.0071 10.9035L11.0078 10.9042C11.0229 10.9193 11.0372 10.9352 11.0508 10.9517C11.057 10.9593 11.0625 10.9674 11.0684 10.9752C11.0754 10.9846 11.0826 10.9937 11.0891 11.0034C11.0954 11.0128 11.1008 11.0225 11.1066 11.0321C11.1118 11.0409 11.1174 11.0495 11.1222 11.0586C11.1275 11.0684 11.1319 11.0785 11.1367 11.0885C11.1412 11.0979 11.1459 11.1072 11.1499 11.1169C11.1539 11.1266 11.1571 11.1366 11.1607 11.1464C11.1644 11.1568 11.1685 11.167 11.1717 11.1777C11.1747 11.1876 11.1769 11.1976 11.1794 11.2075C11.1821 11.2184 11.1851 11.2291 11.1873 11.2401C11.1896 11.2517 11.191 11.2633 11.1926 11.2749C11.194 11.2845 11.1958 11.294 11.1968 11.3037C11.2011 11.3469 11.2011 11.3904 11.1968 11.4336C11.1958 11.4433 11.194 11.4527 11.1926 11.4623C11.1909 11.4739 11.1896 11.4856 11.1873 11.4972C11.1851 11.5082 11.1821 11.5189 11.1793 11.5297C11.1768 11.5396 11.1746 11.5497 11.1716 11.5596C11.1684 11.5702 11.1644 11.5804 11.1607 11.5908C11.1572 11.6007 11.1539 11.6106 11.1499 11.6203C11.1459 11.63 11.1412 11.6393 11.1367 11.6487C11.1319 11.6588 11.1275 11.6688 11.1223 11.6787C11.1174 11.6877 11.1119 11.6963 11.1066 11.7051C11.1008 11.7148 11.0954 11.7245 11.0891 11.7339Z" 
                                    id="Repeat" 
                                    fill="#FFFFFF" 
                                    fillRule="evenodd" 
                                    stroke="none" 
                                />
                            </svg>
                        </button>
                        <button className="shuffle yes">
                            <svg width="16px" height="14px" viewBox="0 0 16 14" version="1.1">
                                <path 
                                    d="M15.8668 11.8352C15.8739 11.8261 15.8812 11.8173 15.8878 11.8079C15.8941 11.7988 15.8996 11.7894 15.9055 11.7801C15.9108 11.7716 15.9164 11.7632 15.9213 11.7545C15.9266 11.745 15.9311 11.7352 15.9359 11.7255C15.9404 11.7164 15.9452 11.7074 15.9493 11.698C15.9533 11.6886 15.9566 11.679 15.9602 11.6695C15.964 11.6594 15.968 11.6495 15.9713 11.6393C15.9743 11.6297 15.9765 11.62 15.979 11.6104C15.9818 11.5999 15.9849 11.5895 15.9871 11.5789C15.9894 11.5677 15.9908 11.5564 15.9925 11.5452C15.9939 11.5359 15.9958 11.5268 15.9967 11.5174C16.001 11.4756 16.001 11.4335 15.9967 11.3918C15.9958 11.3823 15.9939 11.3732 15.9925 11.3639C15.9908 11.3527 15.9895 11.3414 15.9871 11.3302C15.9849 11.3196 15.9819 11.3092 15.9791 11.2987C15.9765 11.2891 15.9743 11.2794 15.9713 11.2699C15.968 11.2596 15.964 11.2497 15.9602 11.2396C15.9566 11.2301 15.9533 11.2205 15.9493 11.2111C15.9452 11.2017 15.9404 11.1927 15.9359 11.1836C15.9311 11.1739 15.9266 11.1641 15.9213 11.1546C15.9164 11.1459 15.9108 11.1376 15.9055 11.1291C15.8996 11.1198 15.8941 11.1103 15.8878 11.1013C15.8812 11.0919 15.8739 11.083 15.8668 11.074C15.8608 11.0664 15.8553 11.0586 15.849 11.0512C15.8352 11.0353 15.8207 11.0199 15.8055 11.0053C15.8052 11.0051 15.805 11.0048 15.8048 11.0046L13.8048 9.09552C13.5444 8.84701 13.1223 8.84701 12.862 9.09552C12.6016 9.34403 12.6016 9.74697 12.862 9.99548L13.7239 10.8182L11.3334 10.8182C9.12423 10.8182 7.33338 9.10873 7.33338 6.99998C7.33338 4.89124 9.12423 3.18179 11.3334 3.18179L13.7239 3.18179L12.862 4.00455C12.6017 4.25306 12.6017 4.656 12.862 4.90451C13.1223 5.15302 13.5445 5.15302 13.8048 4.90451L15.8048 2.99541C15.805 2.99529 15.805 2.99517 15.8052 2.99505C15.8205 2.98035 15.8351 2.96487 15.849 2.94879C15.8553 2.94142 15.8608 2.93367 15.8667 2.92612C15.8738 2.91705 15.8812 2.90819 15.8878 2.89876C15.8941 2.88973 15.8996 2.88033 15.9055 2.87102C15.9108 2.86249 15.9164 2.85417 15.9213 2.84537C15.9266 2.83588 15.9311 2.82613 15.9359 2.81646C15.9405 2.80731 15.9452 2.7983 15.9493 2.78893C15.9534 2.77954 15.9566 2.76996 15.9602 2.76041C15.964 2.75036 15.968 2.74043 15.9713 2.73014C15.9744 2.72059 15.9766 2.7109 15.9791 2.70126C15.9819 2.69079 15.985 2.68044 15.9872 2.66976C15.9895 2.65858 15.9909 2.6473 15.9925 2.63605C15.9939 2.62678 15.9958 2.61762 15.9968 2.60822C16.0011 2.56646 16.0011 2.52437 15.9968 2.48261C15.9958 2.47321 15.994 2.46409 15.9925 2.45481C15.9909 2.44353 15.9895 2.43226 15.9871 2.4211C15.9849 2.41042 15.9819 2.4001 15.9791 2.38963C15.9765 2.37997 15.9743 2.37027 15.9713 2.36073C15.968 2.35047 15.964 2.34053 15.9602 2.33051C15.9566 2.32096 15.9534 2.31136 15.9493 2.30196C15.9452 2.2926 15.9405 2.28359 15.9359 2.27446C15.9311 2.26476 15.9266 2.25501 15.9213 2.24552C15.9164 2.23675 15.9108 2.22843 15.9055 2.2199C15.8997 2.21059 15.8942 2.2012 15.8878 2.19213C15.8812 2.18273 15.8739 2.17387 15.8668 2.16484C15.8609 2.15726 15.8553 2.14947 15.849 2.14211C15.8351 2.12603 15.8206 2.11055 15.8052 2.09584C15.805 2.09572 15.805 2.0956 15.8048 2.09548L13.8048 0.186383C13.5445 -0.0621277 13.1223 -0.0621277 12.862 0.186383C12.6017 0.434894 12.6017 0.837833 12.862 1.08634L13.7239 1.90911L11.3334 1.90911C9.32514 1.90911 7.57644 2.9688 6.66672 4.53418C5.75697 2.96874 4.00827 1.90905 2.00001 1.90905L0.66666 1.90905C0.29847 1.90905 0 2.19398 0 2.54543C0 2.89689 0.29847 3.18179 0.66666 3.18179L2.00001 3.18179C4.20918 3.18179 6.00003 4.89124 6.00003 6.99998C6.00003 9.10873 4.20918 10.8182 2.00001 10.8182L0.66666 10.8182C0.29847 10.8182 0 11.1031 0 11.4545C0 11.806 0.29847 12.0909 0.66666 12.0909L2.00001 12.0909C4.00827 12.0909 5.75697 11.0312 6.66669 9.46582C7.57641 11.0312 9.32511 12.0909 11.3334 12.0909L13.7239 12.0909L12.862 12.9137C12.6016 13.1622 12.6016 13.5651 12.862 13.8136C13.1223 14.0621 13.5444 14.0621 13.8048 13.8136L15.8048 11.9045C15.8049 11.9044 15.805 11.9043 15.8051 11.9042C15.8205 11.8895 15.8351 11.874 15.849 11.8579C15.8553 11.8505 15.8608 11.8427 15.8668 11.8352Z" 
                                    id="Shuffle" 
                                    fill="#FFFFFF" 
                                    stroke="none" 
                                />
                            </svg>
                        </button>
                        <button className="volume">
                            <div className="volume-rate"></div>
                            <svg width="15px" height="13px" viewBox="0 0 15 13" version="1.1">
                            <g id="Volume">
                                <path 
                                    d="M2.64724 3.74227L0 3.74227L0 9.14826L2.64724 9.14826L7.65172 12.5509C7.65172 12.5509 8.57143 13.2553 8.57143 12.5274C8.57143 11.7973 8.57143 0.92153 8.57143 0.257426C8.57143 -0.314049 7.7619 0.244343 7.7619 0.244343L2.64724 3.74227Z" 
                                    id="Volume" 
                                    fill="#FFFFFF" 
                                    stroke="none" 
                                />
                                <path 
                                    d="M0.867067 0.147798C0.668573 -0.049266 0.347365 -0.049266 0.148871 0.147798C-0.0496236 0.345719 -0.0496236 0.66659 0.148871 0.861512C0.802481 1.51311 1.12627 2.35877 1.12756 3.21086C1.12584 4.06466 0.80205 4.91546 0.148871 5.56492C-0.0496236 5.76155 -0.0496236 6.08371 0.148871 6.2812C0.247903 6.37973 0.377505 6.42857 0.50883 6.42857C0.638433 6.42857 0.768035 6.38016 0.867067 6.2812C1.71831 5.4334 2.14372 4.31999 2.14286 3.21086C2.14372 2.10302 1.71702 0.993031 0.867067 0.147798Z" 
                                    transform="translate(9.642858 3.214286)" 
                                    id="Shape" 
                                    fill="#FFFFFF" 
                                    stroke="none" 
                                />
                                <path 
                                    d="M0.994142 0.165444C0.764251 -0.0551478 0.398002 -0.0551478 0.169095 0.165444C-0.0558726 0.386035 -0.0558726 0.740982 0.169095 0.961574C1.4239 2.17554 2.05056 3.7578 2.05154 5.34767C2.05056 6.9447 1.42636 8.53696 0.169095 9.75474C-0.0568571 9.97438 -0.0558726 10.3298 0.169095 10.5504C0.283302 10.6595 0.433445 10.7143 0.581619 10.7143C0.730777 10.7143 0.880427 10.6595 0.994142 10.5504C2.47391 9.1125 3.21429 7.22818 3.21429 5.34767C3.21429 3.47336 2.46899 1.59571 0.994142 0.165444Z" 
                                    transform="translate(11.78571 1.071429)" 
                                    id="Shape" 
                                    fill="#FFFFFF" 
                                    stroke="none" 
                                />
                            </g>
                            </svg>
                        </button>
                    </div>
                    <div className="prev-next">
                        <button className="prev">
                            <svg width="14px" height="9px" viewBox="0 0 14 9" version="1.1">
                                <path 
                                    d="M13.0114 3.50848L8.05331 0.155237C7.74733 -0.0517456 7.38194 -0.0517456 7.076 0.155237C6.77003 0.362125 6.58739 0.732819 6.58739 1.14664L6.58739 3.64643C6.5378 3.59497 6.48328 3.54858 6.42408 3.50852L1.46592 0.155284C1.15994 -0.0516983 0.794553 -0.0516983 0.488614 0.155284C0.182634 0.362172 0 0.732866 0 1.14669L0 7.85331C0 8.26718 0.182715 8.63783 0.488614 8.84472C0.641664 8.94821 0.809425 8.99995 0.977308 8.99995C1.14511 8.99995 1.31295 8.94821 1.46592 8.84472L6.42404 5.49148C6.48332 5.45142 6.5378 5.40508 6.58735 5.35357L6.58735 7.85336C6.58735 8.26723 6.77007 8.63788 7.07596 8.84476C7.22901 8.94825 7.39678 9 7.56466 9C7.73246 9 7.9003 8.94825 8.05327 8.84476L13.0114 5.49152C13.3174 5.28464 13.5 4.91394 13.5 4.50002C13.5 4.08615 13.3174 3.71536 13.0114 3.50848Z" 
                                    transform="matrix(-1 0 0 1 13.5 0)" 
                                    id="Next" 
                                    fill="#FFFFFF" 
                                    stroke="none" 
                                />
                            </svg>
                        </button>
                        <button className="next">
                            <svg width="14px" height="9px" viewBox="0 0 14 9" version="1.1">
                                <path 
                                    d="M13.0114 3.50848L8.05331 0.155237C7.74733 -0.0517456 7.38194 -0.0517456 7.076 0.155237C6.77003 0.362125 6.58739 0.732819 6.58739 1.14664L6.58739 3.64643C6.5378 3.59497 6.48328 3.54858 6.42408 3.50852L1.46592 0.155284C1.15994 -0.0516983 0.794553 -0.0516983 0.488614 0.155284C0.182634 0.362172 0 0.732866 0 1.14669L0 7.85331C0 8.26718 0.182715 8.63783 0.488614 8.84472C0.641664 8.94821 0.809425 8.99995 0.977308 8.99995C1.14511 8.99995 1.31295 8.94821 1.46592 8.84472L6.42404 5.49148C6.48332 5.45142 6.5378 5.40508 6.58735 5.35357L6.58735 7.85336C6.58735 8.26723 6.77007 8.63788 7.07596 8.84476C7.22901 8.94825 7.39678 9 7.56466 9C7.73246 9 7.9003 8.94825 8.05327 8.84476L13.0114 5.49152C13.3174 5.28464 13.5 4.91394 13.5 4.50002C13.5 4.08615 13.3174 3.71536 13.0114 3.50848Z" 
                                    id="Next" 
                                    fill="#FFFFFF" 
                                    stroke="none" 
                                />
                            </svg>
                        </button>
                    </div>
                    <div className="play-pause">
                        <button onClick={this.handlePlay} >
                            {
                                !this.state.playing ?
                                <svg width="13px" height="15px" viewBox="0 0 13 15" version="1.1">
                                    <path d="M1.68201 0L3.77253 0C4.70001 0 5.45455 0.707493 5.45455 1.57715L5.45455 12.9683C5.45455 13.838 4.70001 14.5455 3.77253 14.5455L1.68201 14.5455C0.754532 14.5455 0 13.838 0 12.9683L0 1.57715C0 0.707493 0.754532 0 1.68201 0ZM8.95474 0L11.0453 0C11.9727 0 12.7273 0.707493 12.7273 1.57715L12.7273 12.9683C12.7273 13.838 11.9727 14.5455 11.0453 14.5455L8.95474 14.5455C8.02726 14.5455 7.27273 13.838 7.27273 12.9683L7.27273 1.57715C7.27273 0.707493 8.02726 0 8.95474 0Z" 
                                        id="Pause" 
                                        fill="#336CFB" 
                                        fillRule="evenodd" 
                                        stroke="none" 
                                    />
                                </svg> :
                                <svg width="11px" height="14px" viewBox="0 0 11 14" version="1.1" xmlns="http://www.w3.org/2000/svg">
                                    <g 
                                        id="Icons" 
                                        stroke="none" 
                                        strokeWidth="1" 
                                        fill="none" 
                                        fillRule="evenodd"
                                    >
                                        <g 
                                        id="Rounded" 
                                        transform="translate(-753.000000, -955.000000)">
                                            <g 
                                            id="AV" 
                                            transform="translate(100.000000, 852.000000)">
                                                <g id="-Round-/-AV-/-play_arrow" 
                                                transform="translate(646.000000, 98.000000)">
                                                    <g>
                                                        <rect 
                                                            id="Rectangle-Copy-50" 
                                                            x="0" 
                                                            y="0" 
                                                            width="24" 
                                                            height="24"
                                                        ></rect>
                                                        <path 
                                                            d="M7,6.82 L7,17.18 C7,17.97 7.87,18.45 8.54,18.02 L16.68,12.84 C17.3,12.45 17.3,11.55 16.68,11.15 L8.54,5.98 C7.87,5.55 7,6.03 7,6.82 Z" 
                                                            id="Play" 
                                                            fill="#336CFB"
                                                        ></path>
                                                    </g>
                                                </g>
                                            </g>
                                        </g>
                                    </g>
                                </svg>
                            }
                        </button>
                    </div>
                </div>
            </section>
        )
    }
}

export default Player;